  /* --- GLOBAL STYLES & FONT --- */
        body {
            font-family: 'Fredoka', cursive;
            margin: 0; padding: 0;
            background-color: #fce4ec;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; user-select: none;
            overflow: hidden;
            font-size: 0.9em; /* Base font reduction */
        }
        
        /* --- GAME CONTAINER --- */
        .game-container {
            display: flex; gap: 10px; 
            width: 98%; 
            max-width: 1200px; 
            background-color: #ffffff; 
            border-radius: 20px; 
            border: 7px solid #8e24aa; 
            height: 90vh;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3); 
            position: relative; overflow: hidden;
        }

        /* --- KEYFRAME ANIMATIONS --- */
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }
        @keyframes pulse-success { 0%, 100% {box-shadow: 0 0 15px 5px #69f0ae;} 50% {box-shadow: 0 0 40px 10px #00e676;} }
        @keyframes pulse-danger { 0%, 100% {box-shadow: 0 0 15px 5px #ff5252;} 50% {box-shadow: 0 0 40px 10px #f44336;} }
        @keyframes fade-up { 0% {opacity: 1; transform: translateY(0);} 100% {opacity: 0; transform: translateY(-40px);} }

        /* --- OVERLAYS & SCREENS --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(142, 36, 170, 0.98); 
            z-index: 500; display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white; text-align: center;
            backdrop-filter: blur(5px);
            transition: opacity 0.5s;
        }
        .hidden { opacity: 0; pointer-events: none; }
        
        .title { font-size: 4em; 
            text-shadow: 4px 4px 0 #4a148c; margin-bottom: 5px; color: #ffeb3b; animation: pulse-success 2s infinite; }
        .subtitle { font-size: 1.4em; 
            margin-bottom: 30px; max-width: 600px; line-height: 1.4; color: #f3e5f5;}
        
        .big-btn {
            padding: 15px 40px; 
            font-size: 1.8em; 
            background: #ffca28;
            border: 4px solid #ff6f00; border-radius: 40px; cursor: pointer;
            color: #333; font-weight: 800; box-shadow: 0 8px 0 #e65100;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .big-btn:active { transform: translateY(5px); box-shadow: 0 3px 0 #e65100; }

        /* --- SCENARIO SELECTION --- */
        .scenario-container {
            display: flex; gap: 20px; 
            margin-top: 20px;
        }
        .scenario-card {
            background: #fff; color: #333; padding: 20px; 
            border-radius: 15px;
            width: 250px; 
            cursor: pointer; border: 4px solid #ffca28;
            transition: all 0.2s;
            box-shadow: 0 6px 0 #e65100;
        }
        .scenario-card:hover { transform: translateY(-3px); box-shadow: 0 10px 0 #e65100; }
        .scenario-card h3 { font-size: 1.6em; margin-top: 0; color: #8e24aa; }

        /* --- GAME MAP & ELEMENTS --- */
        #system-map {
            flex: 4; position: relative;
            background-color: #e6ee9c; 
            background-image: radial-gradient(rgba(0,0,0,0.08) 20%, transparent 20%);
            background-size: 40px 40px; 
            cursor: default; overflow: hidden;
            border-radius: 15px;
            margin: 7px; 
        }
        
        .placed-element {
            position: absolute; 
            width: 80px; height: 80px; 
            background: white; border-radius: 15px; 
            border: 4px solid #607d8b; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 5px 0 #90a4ae; 
            z-index: 10;
            transition: box-shadow 0.2s, border 0.3s;
            font-size: 0.8em; 
            font-weight: 700;
            cursor: pointer; 
        }
        .placed-element .icon {
            font-size: 2.5em; 
            line-height: 1;
        }

        /* --- SIDEBAR --- */
        .control-panel {
            flex: 1.5; padding: 15px; 
            background-color: #f3e5f5; 
            display: flex; flex-direction: column; gap: 10px; 
            border-left: 4px solid #8e24aa;
        }
        
        .stat-box {
            background: #e1bee7; 
            padding: 10px; 
            border-radius: 15px;
            border: 2px solid #ce93d8; 
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .credits-text { color: #4a148c; font-size: 1.8em; 
            font-weight: 800; transition: color 0.5s; }
        .score-text { color: #00e676; font-size: 1.8em; 
            font-weight: 800; text-shadow: 1px 1px 1px #333;}
        
        /* New Grouping for Status/Rating */
        .status-group {
             display: grid;
             grid-template-columns: 1fr 1fr;
             gap: 10px;
        }

        /* Time/Event Box */
        .time-box {
            background:#bbdefb; padding:10px; border-radius:15px; border:2px solid #64b5f6; text-align:center;
            display: flex; flex-direction: column; justify-content: center;
        }
        .event-box {
            margin-top: 5px; padding: 5px; background: #fff9c4; border: 1px solid #ffca28; border-radius: 8px;
            font-size: 0.8em; font-weight: 700; color: #e65100;
        }

        /* Monthly Rating */
        .rating-box {
            background: #fff3e0; 
            border-color: #ffb74d;
            padding: 10px; 
            border-radius: 15px;
            border: 2px solid #ffb74d; 
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #final-score-rating { font-size: 2.5em !important; font-weight: 800; color: #ff9800;}

        /* Legend */
        .control-panel h3 { font-size: 1.2em; margin-top: 8px; margin-bottom: 5px;}
        .control-panel div[style*="grid-template-columns"] span { font-size: 0.8em; }


        /* Modal Styles */
        .modal-box { 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            max-width: 650px; 
            width: 90%; 
            max-height: 80vh; 
            overflow-y: auto;
            color: #333;
            text-align: left;
            border: 4px solid #2196f3;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            font-family: 'Poppins', sans-serif;
        }
        .modal-box h2 { font-size: 1.6em; color: #2196f3; margin-top: 0; border-bottom: 2px solid #2196f3; padding-bottom: 5px;}
        .modal-box h4 { font-size: 1.2em; color: #4a148c; margin-top: 10px; }

        /* Mascot */
        .mascot-container {
             width: 250px !important; 
             padding: 10px !important;
             bottom: 5px !important;
             right: 5px !important;
        }
        .mascot-face { font-size: 2em !important; }
        .mascot-text { font-size: 1em !important; }


        /* Upgrade Modal Specifics */
        .modal-box[style*="width:350px"] { 
            width: 350px !important; 
        }

        /* --- GUIDE MODAL --- */
        #guideModal {
            position: absolute; 
            top: 0;
            right: 0;
            width: 300px; 
            height: 100%;
            z-index: 502;
            display: block; 
            overflow: hidden;
            pointer-events: none; 
            transform: translateX(100%); 
            transition: transform 0.3s ease-out;
        }
        
        #guideModal.active {
            transform: translateX(0); 
            pointer-events: auto; 
        }
        
        #guide-modal-content {
            width: 100%; 
            height: 100%;
            border-radius: 0;
            border: none;
            background: white;
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
            padding: 25px;
            overflow-y: auto;
            max-height: 100%;
            box-sizing: border-box;
            pointer-events: auto; 
        }